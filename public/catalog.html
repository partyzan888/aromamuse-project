<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Каталог - AromaMuse</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Cormorant+Garamond:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; color: #1f1a17; }
        .font-serif { font-family: 'Cormorant Garamond', serif; }
        .brand-brown { background-color: #4d3a30; }
        .brand-beige { background-color: #f5f1e9; }
        .brand-dark-text { color: #4d3a30; }
        .custom-checkbox:checked {
            background-image: url("data:image/svg+xml,%3csvg viewBox='0 0 16 16' fill='white' xmlns='http://www.w3.org/2000/svg'%3e%3cpath d='M12.207 4.793a1 1 0 010 1.414l-5 5a1 1 0 01-1.414 0l-2-2a1 1 0 011.414-1.414L6.5 9.086l4.293-4.293a1 1 0 011.414 0z'/%3e%3c/svg%3e");
            background-color: #4d3a30; border-color: #4d3a30;
        }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        /* Анимация появления карточек */
        @keyframes fade-in-up-card {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .product-card-animation {
            opacity: 0; 
        }
        .product-card-animation.animate {
            animation: fade-in-up-card 0.6s ease-out forwards;
        }
    </style>
</head>
<body class="bg-white">

    <!-- Header -->
    <header class="bg-white/90 backdrop-blur-md sticky top-0 z-50 border-b border-gray-200">
        <div class="container mx-auto px-4">
            <div class="flex items-center justify-between h-24">
                <a href="./index.html" class="h-20"><img src="http://googleusercontent.com/file_content/1" alt="Логотип AromaMuse" class="h-full w-auto"></a>
                <nav class="hidden md:flex items-center space-x-8 font-serif text-xl brand-dark-text">
                    <a href="./catalog.html" class="hover:text-gray-900">Каталог</a>
                    <a href="#" class="hover:text-gray-900">Бренды</a>
                    <a href="#" class="hover:text-gray-900">О нас</a>
                </nav>
                <div class="flex items-center space-x-5 brand-dark-text">
                    <a href="./account.html" class="hover:text-gray-900"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" /></svg></a>
                    <a href="./cart.html" class="hover:text-gray-900 relative"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" /></svg><span class="absolute -top-2 -right-2 brand-brown text-white text-xs rounded-full h-5 w-5 flex items-center justify-center">0</span></a>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="container mx-auto px-4 py-8 md:py-12">
        <div class="flex flex-col md:flex-row gap-8 lg:gap-12">
            <aside id="filters-sidebar" class="w-full md:w-1/4 lg:w-1/5 space-y-6 hidden md:block">
                <h2 class="font-serif text-3xl brand-dark-text">Фильтры</h2>
                <form id="filter-form">
                    <div class="filter-group border-b pb-6">
                        <h3 class="font-semibold mb-3 brand-dark-text">Ноты</h3>
                        <div class="space-y-2 max-h-48 overflow-y-auto no-scrollbar">
                            <label class="flex items-center"><input type="checkbox" name="notes" value="Роза" class="h-4 w-4 rounded border-gray-300 focus:ring-brand-brown custom-checkbox mr-2">Роза</label>
                            <label class="flex items-center"><input type="checkbox" name="notes" value="Жасмин" class="h-4 w-4 rounded border-gray-300 focus:ring-brand-brown custom-checkbox mr-2">Жасмин</label>
                            <label class="flex items-center"><input type="checkbox" name="notes" value="Сандал" class="h-4 w-4 rounded border-gray-300 focus:ring-brand-brown custom-checkbox mr-2">Сандал</label>
                            <label class="flex items-center"><input type="checkbox" name="notes" value="Ваниль" class="h-4 w-4 rounded border-gray-300 focus:ring-brand-brown custom-checkbox mr-2">Ваниль</label>
                        </div>
                    </div>
                    <div class="filter-group border-b pb-6 mt-6">
                        <h3 class="font-semibold mb-3 brand-dark-text">Бренд</h3>
                        <div class="space-y-2 max-h-48 overflow-y-auto no-scrollbar">
                            <label class="flex items-center"><input type="checkbox" name="brand" value="Byredo" class="h-4 w-4 rounded border-gray-300 focus:ring-brand-brown custom-checkbox mr-2">Byredo</label>
                            <label class="flex items-center"><input type="checkbox" name="brand" value="Creed" class="h-4 w-4 rounded border-gray-300 focus:ring-brand-brown custom-checkbox mr-2">Creed</label>
                            <label class="flex items-center"><input type="checkbox" name="brand" value="Tom Ford" class="h-4 w-4 rounded border-gray-300 focus:ring-brand-brown custom-checkbox mr-2">Tom Ford</label>
                        </div>
                    </div>
                    <button type="submit" class="mt-6 w-full brand-brown text-white py-3 rounded-lg hover:bg-gray-700 transition-all duration-300 font-semibold tracking-wide">Применить</button>
                </form>
            </aside>
            <main class="w-full md:w-3/4 lg:w-4/5">
                <div class="flex flex-col sm:flex-row justify-between items-center mb-6">
                    <h1 class="font-serif text-4xl brand-dark-text mb-4 sm:mb-0">Каталог</h1>
                    <button id="mobile-filter-btn" class="md:hidden w-full bg-gray-100 border p-3 rounded-lg flex items-center justify-center mb-4">Фильтры</button>
                </div>
                <div id="product-grid" class="grid grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-x-6 gap-y-10">
                    <!-- Товары будут загружены сюда динамически -->
                </div>
            </main>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const productGrid = document.getElementById('product-grid');
            const filterForm = document.getElementById('filter-form');

            const createProductCard = (product) => {
                const minPrice = product.variants.reduce((min, v) => v.price < min ? v.price : min, product.variants[0].price);
                
                return `
                    <a href="./product-page.html?id=${product.id}" class="group block product-card-animation transform hover:scale-105 transition-transform duration-300">
                        <div class="w-full overflow-hidden rounded-lg brand-beige mb-4 border border-gray-200/80">
                            <img src="https://placehold.co/400x400/f5f1e9/4d3a30?text=${product.name.split(' ')[0]}" alt="[Изображение] ${product.name}" class="w-full h-full object-cover object-center group-hover:opacity-75 transition-opacity">
                        </div>
                        <h3 class="font-serif text-xl brand-dark-text">${product.name}</h3>
                        <p class="text-sm text-gray-500 mb-2">${product.brand}</p>
                        <p class="text-lg font-semibold brand-dark-text">от ${Math.round(minPrice)} ₽</p>
                    </a>
                `;
            };
            
            const fetchAndRenderProducts = async (queryParams = '') => {
                productGrid.innerHTML = '<p class="col-span-full text-center">Загрузка товаров...</p>';
                try {
                    // В реальном приложении здесь будет URL вашего API:
                    // const response = await fetch(`/api/products${queryParams}`);
                    // const products = await response.json();
                    
                    const mockProducts = [
                        { id: 1, name: 'Gypsy Water', brand: 'Byredo', variants: [{price: 2800}, {price: 19500}] },
                        { id: 2, name: 'Tobacco Vanille', brand: 'Tom Ford', variants: [{price: 4500}, {price: 24500}] },
                        { id: 3, name: 'Aventus', brand: 'Creed', variants: [{price: 5000}, {price: 30000}] },
                        { id: 4, name: 'Black Orchid', brand: 'Tom Ford', variants: [{price: 3200}, {price: 21000}] },
                    ];
                    const params = new URLSearchParams(queryParams.substring(1));
                    const brands = params.getAll('brand');
                    let products = mockProducts;
                    if (brands.length > 0) {
                        products = products.filter(p => brands.includes(p.brand));
                    }

                    productGrid.innerHTML = '';
                    if (products.length === 0) {
                        productGrid.innerHTML = '<p class="col-span-full text-center">Товары не найдены.</p>';
                        return;
                    }
                    products.forEach((product, index) => {
                        const cardHTML = createProductCard(product);
                        const cardNode = document.createElement('div');
                        cardNode.innerHTML = cardHTML;
                        productGrid.appendChild(cardNode.firstChild);
                        
                        setTimeout(() => {
                            productGrid.lastChild.classList.add('animate');
                        }, index * 100);
                    });

                } catch (error) {
                    productGrid.innerHTML = '<p class="col-span-full text-center text-red-600">Ошибка при загрузке товаров.</p>';
                }
            };

            filterForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const formData = new FormData(filterForm);
                const params = new URLSearchParams();
                formData.getAll('notes').forEach(note => params.append('notes', note));
                formData.getAll('brand').forEach(brand => params.append('brand', brand));
                const queryString = params.toString();
                fetchAndRenderProducts(queryString ? `?${queryString}` : '');
            });

            fetchAndRenderProducts();
            
            const mobileFilterBtn = document.getElementById('mobile-filter-btn');
            const filtersSidebar = document.getElementById('filters-sidebar');
            mobileFilterBtn.addEventListener('click', () => {
                filtersSidebar.classList.toggle('hidden');
            });
        });
    </script>
</body>
</html>
