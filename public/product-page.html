<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Загрузка... - AromaMuse</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Cormorant+Garamond:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; color: #1f1a17; }
        .font-serif { font-family: 'Cormorant Garamond', serif; }
        .brand-brown { background-color: #4d3a30; }
        .brand-beige { background-color: #f5f1e9; }
        .brand-dark-text { color: #4d3a30; }
        .radio-label input:checked + div { border-color: #4d3a30; box-shadow: 0 0 0 2px #4d3a30; }
        .notification { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); padding: 12px 24px; border-radius: 8px; background-color: #2c3e50; color: white; z-index: 100; opacity: 0; visibility: hidden; transition: opacity 0.3s, visibility 0.3s; }
        .notification.show { opacity: 1; visibility: visible; }
        .star-rating input { display: none; }
        .star-rating label { font-size: 2rem; color: #d1d5db; cursor: pointer; transition: color 0.2s; }
        .star-rating input:checked ~ label, .star-rating label:hover, .star-rating label:hover ~ label { color: #e1c59a; }

        @keyframes fade-in { from { opacity: 0; } to { opacity: 1; } }
        @keyframes fade-in-up { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fade-in 0.8s ease-out both; }
        .animate-fade-in-up { opacity: 0; animation: fade-in-up 0.7s ease-out forwards; }
    </style>
</head>
<body class="bg-white">

    <header class="bg-white/90 backdrop-blur-md sticky top-0 z-50 border-b border-gray-200">
        <div class="container mx-auto px-4"><div class="flex items-center justify-between h-24"><a href="./index.html" class="h-20"><img src="http://googleusercontent.com/file_content/1" alt="Логотип AromaMuse" class="h-full w-auto"></a><nav class="hidden md:flex items-center space-x-8 font-serif text-xl brand-dark-text"><a href="./catalog.html" class="hover:text-gray-900">Каталог</a><a href="#" class="hover:text-gray-900">Бренды</a><a href="#" class="hover:text-gray-900">О нас</a></nav><div class="flex items-center space-x-5 brand-dark-text"><a href="./account.html" class="hover:text-gray-900"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" /></svg></a><a href="./cart.html" class="hover:text-gray-900 relative"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" /></svg><span id="cart-count" class="absolute -top-2 -right-2 brand-brown text-white text-xs rounded-full h-5 w-5 flex items-center justify-center">0</span></a></div></div></div>
    </header>

    <main id="product-details-container" class="container mx-auto px-4 py-8 md:py-16">
        <!-- Содержимое товара будет загружено сюда -->
    </main>

    <section id="reviews-section" class="container mx-auto px-4 pb-16">
        <!-- Содержимое отзывов будет загружено сюда -->
    </section>
    
    <div id="notification" class="notification">Товар добавлен в корзину!</div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const productContainer = document.getElementById('product-details-container');
            const reviewsContainer = document.getElementById('reviews-section');
            const cartCountElement = document.getElementById('cart-count');
            const notificationElement = document.getElementById('notification');

            const showNotification = (message) => {
                notificationElement.textContent = message;
                notificationElement.classList.add('show');
                setTimeout(() => {
                    notificationElement.classList.remove('show');
                }, 2000);
            };

            const renderProduct = (product) => {
                document.title = `${product.name} - AromaMuse`;
                const variantsHTML = product.variants.map((variant, index) => `<label class="radio-label cursor-pointer"><input type="radio" name="volume" value="${variant.price}" data-variant-id="${variant.id}" class="sr-only" ${index === 0 ? 'checked' : ''}><div class="border rounded-lg p-4 text-center transition-all duration-200"><span class="font-semibold block brand-dark-text">${variant.volume}</span><span class="text-sm text-gray-500">${variant.type}</span></div></label>`).join('');
                const notesHTML = product.Notes.map(note => note.name).join(', ');
                productContainer.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8 lg:gap-16">
                    <div class="animate-fade-in">
                        <div class="w-full overflow-hidden rounded-lg brand-beige mb-4 border border-gray-200/80">
                            <img id="main-image" src="https://placehold.co/600x600/f5f1e9/4d3a30?text=${product.name.split(' ')[0]}" alt="[Изображение] ${product.name}" class="w-full h-full object-cover transition-opacity duration-300">
                        </div>
                    </div>
                    <div>
                        <p class="font-serif text-xl brand-dark-text animate-fade-in-up" style="animation-delay: 0.1s;">${product.brand}</p>
                        <h1 class="font-serif text-5xl brand-dark-text mt-1 mb-4 animate-fade-in-up" style="animation-delay: 0.2s;">${product.name}</h1>
                        <div class="mb-6 animate-fade-in-up" style="animation-delay: 0.3s;"><p class="text-gray-600 leading-relaxed">${product.description}</p></div>
                        <div class="mb-6 animate-fade-in-up" style="animation-delay: 0.4s;">
                            <h3 class="font-semibold mb-3 brand-dark-text">Выберите объем:</h3>
                            <div id="volume-selector" class="grid grid-cols-3 gap-3">${variantsHTML}</div>
                        </div>
                        <div class="flex items-center justify-between bg-brand-beige p-4 rounded-lg mb-6 animate-fade-in-up" style="animation-delay: 0.5s;">
                            <span id="product-price" class="font-serif text-4xl brand-dark-text">${Math.round(product.variants[0].price)} ₽</span>
                            <button id="add-to-cart-btn" class="brand-brown text-white py-3 px-8 rounded-lg hover:bg-gray-700 transition-all duration-300 font-semibold tracking-wide relative overflow-hidden">
                                <span class="button-text">В корзину</span>
                                <span class="button-icon absolute inset-0 flex items-center justify-center transform scale-150 opacity-0 transition-all duration-300">✓</span>
                            </button>
                        </div>
                        <div class="border-t pt-6 animate-fade-in-up" style="animation-delay: 0.6s;">
                            <h3 class="font-serif text-2xl brand-dark-text mb-4">Пирамида аромата</h3>
                            <div class="space-y-3 text-gray-700"><p><strong>Ноты:</strong> ${notesHTML}</p></div>
                        </div>
                    </div>
                </div>`;
            };

            const renderReviews = (reviews) => {
                const reviewsListHTML = reviews.length > 0 ? reviews.map(review => `
                    <div class="border-t py-4">
                        <div class="flex items-center mb-2">
                            <p class="font-semibold brand-dark-text mr-2">${review.User.firstName}</p>
                            <div class="flex text-yellow-500">${'★'.repeat(review.rating)}${'☆'.repeat(5 - review.rating)}</div>
                        </div>
                        <p class="text-gray-600">${review.comment}</p>
                    </div>
                `).join('') : '<p class="text-gray-500">Отзывов пока нет. Будьте первым!</p>';

                reviewsContainer.innerHTML = `
                    <h2 class="font-serif text-4xl brand-dark-text mb-8">Отзывы</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-16">
                        <div>
                            <h3 class="font-serif text-2xl brand-dark-text mb-4">Оставить отзыв</h3>
                            <form id="review-form" class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Рейтинг</label>
                                    <div class="star-rating flex flex-row-reverse justify-end">
                                        <input type="radio" id="star5" name="rating" value="5" required/><label for="star5">★</label>
                                        <input type="radio" id="star4" name="rating" value="4" /><label for="star4">★</label>
                                        <input type="radio" id="star3" name="rating" value="3" /><label for="star3">★</label>
                                        <input type="radio" id="star2" name="rating" value="2" /><label for="star2">★</label>
                                        <input type="radio" id="star1" name="rating" value="1" /><label for="star1">★</label>
                                    </div>
                                </div>
                                <div>
                                    <label for="comment" class="block text-sm font-medium text-gray-700">Ваш комментарий</label>
                                    <textarea id="comment" name="comment" rows="4" class="mt-1 w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-brand-brown" required></textarea>
                                </div>
                                <button type="submit" class="brand-brown text-white py-2 px-6 rounded-lg hover:bg-gray-700 transition-all duration-300 font-semibold tracking-wide">Отправить отзыв</button>
                            </form>
                        </div>
                        <div id="reviews-list">
                            ${reviewsListHTML}
                        </div>
                    </div>
                `;
                attachReviewFormListener();
            };
            
            const attachEventListeners = () => {
                const addToCartBtn = document.getElementById('add-to-cart-btn');
                const volumeSelector = document.getElementById('volume-selector');
                const priceElement = document.getElementById('product-price');

                if (volumeSelector) {
                    volumeSelector.addEventListener('change', (event) => {
                        if (event.target.name === 'volume') {
                            priceElement.textContent = `${Math.round(event.target.value)} ₽`;
                        }
                    });
                }

                if(addToCartBtn) {
                    addToCartBtn.addEventListener('click', () => {
                        const buttonText = addToCartBtn.querySelector('.button-text');
                        const buttonIcon = addToCartBtn.querySelector('.button-icon');
                        
                        if (addToCartBtn.disabled) return;
                        
                        addToCartBtn.disabled = true;
                        buttonText.classList.add('opacity-0', 'scale-150');
                        buttonIcon.classList.remove('opacity-0', 'scale-150');
                        
                        const currentCount = parseInt(cartCountElement.textContent, 10) || 0;
                        cartCountElement.textContent = currentCount + 1;
                        showNotification('Товар добавлен в корзину!');
                        
                        setTimeout(() => {
                            buttonText.classList.remove('opacity-0', 'scale-150');
                            buttonIcon.classList.add('opacity-0', 'scale-150');
                            addToCartBtn.disabled = false;
                        }, 1500);
                    });
                }
            };

            const attachReviewFormListener = () => {
                const reviewForm = document.getElementById('review-form');
                if (reviewForm) {
                    reviewForm.addEventListener('submit', async (e) => {
                        e.preventDefault();
                        alert("Спасибо за ваш отзыв!");
                        reviewForm.reset();
                    });
                }
            };

            const fetchProductAndReviews = async (id) => {
                productContainer.innerHTML = '<p class="text-center">Загрузка товара...</p>';
                try {
                    const mockDatabase = {
                        '1': { product: { id: 1, name: 'Gypsy Water', brand: 'Byredo', description: 'Ода красоте цыганской культуры...', variants: [{ id: 101, volume: '100 мл', price: '19500.00', type: 'Флакон' }, { id: 102, volume: '10 мл', price: '2800.00', type: 'Отливант' }], Notes: [{ name: 'Бергамот' }, { name: 'Сандал' }] },
                               reviews: [{ rating: 5, comment: 'Волшебный аромат, очень стойкий!', User: { firstName: 'Анна' } }, { rating: 4, comment: 'Интересный, но на любителя.', User: { firstName: 'Иван' } }] },
                        '2': { product: { id: 2, name: 'Tobacco Vanille', brand: 'Tom Ford', description: 'Роскошный и теплый аромат...', variants: [{ id: 201, volume: '50 мл', price: '24500.00', type: 'Флакон' }, { id: 202, volume: '10 мл', price: '4500.00', type: 'Отливант' }], Notes: [{ name: 'Табак' }, { name: 'Ваниль' }] },
                               reviews: [] },
                    };
                    const data = mockDatabase[id];
                    if (!data) throw new Error('Товар не найден');
                    
                    renderProduct(data.product);
                    renderReviews(data.reviews);
                    attachEventListeners();
                } catch (error) {
                    productContainer.innerHTML = `<p class="text-center text-red-600">Ошибка: ${error.message}.</p>`;
                }
            };

            const params = new URLSearchParams(window.location.search);
            const productId = params.get('id') || '1';
            fetchProductAndReviews(productId);
        });
    </script>
</body>
</html>
